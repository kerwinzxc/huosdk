<admintpl file="header" />
<link rel="stylesheet" href="__PUBLIC__/css/dev/regmain.css">
<link rel="stylesheet" href="__PUBLIC__/css/dev/form.css">
<style type="text/css">
.logoupload{height:50px;padding:20px 0 0 0;}
.logoupload .uploadtip{float:left;padding:5px 10px;background:#E8F0FF;border:solid 1px #BCD2FF;line-height:18px;margin:8px 0 0 15px;display:inline;color:#5e5e5e;}
.logoupload .uploadtip b{color:#ff6600;margin:0 5px;}
.logoupload .btnbox{width:143px;height:45px;float:left;}
.logoupload .fl-progress{float:left;margin-top:0!important;margin-left:20px;display:inline;}
.logoupload .uploadbtn{float:left;width:145px;height:47px;line-height:999em;overflow:hidden;font-size:14px;display:block;color:#ffffff;}


/* progress-box */
.progress-box{width:300px;margin:10px 0 0 0;}
.progress-num{height:30px;line-height:30px;overflow:hidden;font-size:14px;}
.progress-num b{font-weight:400;color:#3366cc;}
.progress-bar{width:100%;height:8px;overflow:hidden;position:relative;background:#dedede;}
.progress-bar .bar-line{position:absolute;left:0;top:0;height:8px;overflow:hidden;background:#007cdc;}


.checkbox{display:inline;}
</style>
</head>
<body>

<!--头部结束-->

<div class="container">
    <h2 class="form-title">完善个人信息</h2>
    <div class="content-body1">
        
    <form action="{:U('User/doaccinfo')}" method="post" class="form formcontent">
    <div class="form-area">
    	<h3 class="form-legend"><strong>基本信息</strong></h3>
    	        
    	<div class="form-cont basic">
    		<div class="line">
    			<span class="label-group">注册账号：</span><strong class="reg-email">{$user.user_login}</strong>
    			<p class="tip">用此账号进行登录。</p>
    		</div>
    		<div class="line">
    			<label for="developer-name" class="label-group">企业名称：</label>
				<input type="text" id="developer-name" datatype="*3-50" maxlength="49" data-msg="企业名称格式错误" value="" class="input-txt" name="fullname">
				<strong class="Validform_checktip"></strong>
    			<p class="tip">请与企业营业执照保持一致。</p>
    		</div>
			
			<!--上传-->
			<div class="line ">
				<label for="developer-passport" class="label-group">营业执照：</label>
				<a id="uploadBtnHolder" class="uploadbtn" href="javascript:;">上传营业执照</a>
				<input id="imgurl" type="text" datatype="*" class="imgurl" data-msg='请上传营业执照' style="width:1px;height:1px;border:1px solid #fff;background:#fff;outline:none">
				<strong class="Validform_checktip" style="margin-left:336px"></strong>
				<p class="tip">请上传扫描件，jpg、png、gif格式的图片（不超过1M)。</p>
				<div id="corpLicenseUploadProgress" class="upload-progress">
					<div class="progress-box fl-progress" style="display:none;">
						<div class="progress-num">上传进度：<b>0%</b></div>
						<div class="progress-bar">
							<div style="width:0%;" class="bar-line"></div>
						</div>
					</div>
				</div>
				<input type="hidden" id="imgname" name="imgname" class="imgname" value="">
			</div>
			<!--上传-->

    		<span class="label-group">注册地址：</span>
				
                <span class="province" style="display: none;"></span><span class="city" style="margin-right: 12px; display: none;"></span>
				<input type="text" id="developer-addr" name="licenseAddr" datatype="*" data-msg="注册地址不能为空" value="" class="input-txt addr-input"><strong class="Validform_checktip"></strong>
			
            <p class="tip">请与企业营业执照保持一致。</p>
            <input type="hidden" id="cmpareas" class="areahidden" value=",,">
            <p class="warning" style="display:none;">开发者资料的基本信息已通过审核，如需修改请发送邮件到damaizhushou@93damai.com。</p>
    	</div>
    	  <script type="text/javascript">
            //获取审核状态
            var devcertifystatus = 0
        </script>
    	<h3 class="form-legend">
		<strong>联系方式</strong></h3>
    	    	<div class="form-cont">
    		<div class="line">
    			<div class="line">
	    			<span class="label-group">联系人姓名：</span><input type="text" id="developer-name" name="contact" datatype="s" maxlength="20" data-msg="联系人姓名不能为空" value="" class="input-txt"><strong class="Validform_checktip"></strong>
	    		</div>
    			<span class="label-group">联系地址：</span>

				<input type="text" id="addr" name="addr" datatype="s" data-msg="联系地址不能为空" value="" class="input-txt addr-input">
				<strong class="Validform_checktip"></strong>
    			<p class="tip">请填写详细联系地址。</p>
    			<input type="hidden" id="areas" class="areahidden" value=",,">
    		</div>
    		<div class="line">
    			<label for="developer-email" class="label-group">电子邮箱：</label><input type="text" datatype="e" data-msg="电子邮箱不符合规则" name="email" id="developer-email" value="" class="input-txt"><strong class="Validform_checktip"></strong>
    			<p class="tip">用于接收合作邮件及审核通知等重要信息。</p>
    		</div>
    		<div class="line">
    			<label for="developer-mobile" class="label-group">手机号码：</label><input type="text" id="developer-mobile" recheck="phone" datatype="corp-mobile"  name="phone" data-msg="手机号码不符合规则" value="" class="input-txt mobile-input"><strong class="Validform_checktip"></strong>
                
    		</div>
    		
    	</div>
    	
    </div>
    <div class="submit-area">
		<input type="hidden" id="curl" value="{:U('User/doaccinfo')}">
		<input type="hidden" id="cid" value="{$user.cid}">
		<p class="line"><label for="isReaded" class="service-cond">
		<input type="checkbox" id="isReaded" class="checkbox">我已阅读并同意<a href="" target="_blank" class="service-link">《大麦开放平台服务条款》</a></label></p>
		<a href="javascript:;" class="btn-submit disabled">同意修改信息</a>
		<!-- <input type='submit' class="btn-submit disabled" name='sub' value='同意并注册开发者'/> -->
	</div>
    
	</form>
</div>
</div>
</body>

<script type="text/javascript" src="__PUBLIC__/js/jquery.js"></script>
<!-- 上传必备插件 -->
<script type="text/javascript" src="/public/js/plugin/swfupload/swfupload.js"></script>
<script type="text/javascript" src="/public/js/plugin/swfupload/swfupload.queue.js"></script>
<script type="text/javascript" src="/public/js/plugin/swfupload/swfupload.speed.js"></script>
<script type="text/javascript" src="/public/js/plugin/swfupload/handlers.js"></script>


<script type="text/javascript">
//文本格式判断
function format_check(name){
	var reg,result,value,name,elm;
	
	elm = $("input[name="+ name +"]");
	value = elm.val();
	console.log(value);
	//name = elm.attr('name');
	switch (name){
		case 'fullname':
			reg = /^(([\u4e00-\u9fff]{2,20})|([a-z\.\s\,]{2,20}))$/i;
			break;
		case 'imgname':
			reg = /\S+/;
			break;
		case 'licenseAddr':
			reg = /\S+/;
			break;
		case 'contact':
			reg = /^(([\u4e00-\u9fff]{2,7})|([a-z\.\s\,]{2,10}))$/i;
			break;
		case 'addr':
			reg = /\S+/;
			break;
		case 'email':
			reg = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			break;
		case 'phone':
			reg = /^1[3|4|5|7|8]\d{9}$/;
			break;
	}
	result = value.match(reg);
	isres =  result ?  true : false;
	showtip(isres,name);
	
	return isres;
}

//根据格式判断进行文本提示
function showtip(istf,name){
	var elmo;
	elmo = $("input[name="+ name +"]");
	if(name == 'imgname'){
		elmo = elmo.siblings('#imgurl');
	}
	if(!istf){
		elmo.next().addClass('Validform_wrong').text(elmo.data('msg'));
		elmo.next().removeClass('Validform_right');
	}else{
		elmo.next().removeClass('Validform_wrong').html('&nbsp;');
		elmo.next().addClass('Validform_right');
	}
}

$(function(){
	$('.input-txt').blur(function(){
		var onename,oneval,oneres,onefc;
		onename = $(this).attr('name');
		onefc = format_check(onename);
		showtip(onefc);
	});
	
	$('.btn-submit').click(function(){
		var frm,issub;
		var arr = new Array();
		frm = $(".form").serializeArray();
		$.each(frm,function(i,elm){
			arr[i] = format_check(elm.name);	
		});
		issub = $.inArray(false,arr);//arr中是否存在false
		if(issub == -1 && $('#isReaded').attr('checked')){
			$('.form').submit();
		}
		
	});
	
	$('#isReaded').click(function(){
		$(this).attr('checked') ? $('.btn-submit').removeClass('disabled') : $('.btn-submit').addClass('disabled');
	});
	
	
	
	
});
</script>


<script type="text/javascript">
function updateProgress(file) {
	$('.progress-box .progress-bar > div').css('width', parseInt(file.percentUploaded) + '%');
	$('.progress-box .progress-num > b').html(SWFUpload.speed.formatPercent(file.percentUploaded));
}

function initProgress() {
	$('.progress-box').show();
	$('.progress-box .progress-bar > div').css('width', '0%');
	$('.progress-box .progress-num > b').html('0%');
}

function successAction(d, b, e) {
	// 如果上传完成了
	
	var data = $.parseJSON(b);
	//alert(data.msg);
        if(d && b){
			$('#imgurl').attr("value","http://www.93damai.com");
			$("#imgname").attr("value",data.imgFile);//填充内容 
			alert(data.msg);
        }else{
            //上传失败
            alert("上传失败");
        }
	$('.progress-box').hide();
	
}

var swfImageUpload;
$(document).ready(function() {
	var cid = $('#cid').val();
	var settings = {
		flash_url : "/public/js/plugin/swfupload/swfupload.swf",
		flash9_url : "/public/js/plugin/swfupload/swfupload_fp9.swf",
		upload_url: "{:U('User/upload')}",// 接受上传的地址
		file_size_limit : "1 MB",// 文件大小限制
        use_query_string : false,
		post_params : {
			"cid" : cid
		},
		file_types : "*.jpg;*.gif;*.png;*.jpeg;",// 限制文件类型
		file_types_description : "Image Files",// 说明，自己定义
		file_upload_limit : 100,
		file_queue_limit : 0,
		custom_settings : {},
		debug: false,
		// Button settings
		button_image_url: "/public/js/plugin/swfupload/upload-btn.png",
		button_width: "143",
		button_height: "45 ",
		button_placeholder_id: 'uploadBtnHolder',
		button_window_mode : SWFUpload.WINDOW_MODE.TRANSPARENT,
		button_cursor : SWFUpload.CURSOR.HAND,
		button_action: SWFUpload.BUTTON_ACTION.SELECT_FILE,
		
		moving_average_history_size: 40,
		
		// The event handler functions are defined in handlers.js
		swfupload_preload_handler : preLoad,
		swfupload_load_failed_handler : loadFailed,
		file_queued_handler : fileQueued,
		file_dialog_complete_handler: fileDialogComplete,
		upload_start_handler : function (file) {
			initProgress();
			updateProgress(file);
		},
		upload_progress_handler : function(file, bytesComplete, bytesTotal) {
			updateProgress(file);
		},
		upload_success_handler : function(file, data, response) {
			// 上传成功后处理函数
			//var fileInfo = eval("(" + data + ")");
			successAction(file, data, response);
			format_check('imgname');
		},
		upload_error_handler : function(file, errorCode, message) {
			console.log(file);
			//alert('Code:'+errorCode+" msg:"+message);
		},
		file_queue_error_handler : function(file, errorCode, message) {
			if(errorCode == -110) {
				alert('您选择的文件太大了。');	
			}
		}
	};
	
	swfImageUpload = new SWFUpload(settings);
});
</script>


<script src="__PUBLIC__/js/dev/validform_min.js" type="text/javascript" defer=""></script></body></html>